<div class="expense-list">
  <h2><i class="fas fa-list"></i> Liste des depenses</h2>

  <div class="filters">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onFiltersChanged()" placeholder="Rechercher une depense...">
    </div>
    <select [(ngModel)]="selectedCategory" (ngModelChange)="onFiltersChanged()" class="filter-select">
      <option value="">Toutes les categories</option>
      <option *ngFor="let cat of categoryService.getCategories()()" [value]="cat">{{ cat }}</option>
    </select>
    <select [(ngModel)]="sortBy" (ngModelChange)="onFiltersChanged()" class="filter-select">
      <option value="date">Trier par date</option>
      <option value="amount">Trier par montant</option>
      <option value="category">Trier par categorie</option>
    </select>
  </div>

  <div class="filters advanced">
    <input type="date" class="filter-select" [(ngModel)]="startDate" (ngModelChange)="onFiltersChanged()">
    <input type="date" class="filter-select" [(ngModel)]="endDate" (ngModelChange)="onFiltersChanged()">
    <input type="number" class="filter-select" placeholder="Montant min" [(ngModel)]="minAmount" (ngModelChange)="onFiltersChanged()">
    <input type="number" class="filter-select" placeholder="Montant max" [(ngModel)]="maxAmount" (ngModelChange)="onFiltersChanged()">
    <button class="reset-btn" (click)="resetFilters()"><i class="fas fa-undo"></i> Reset</button>
  </div>

  <div *ngIf="filteredExpenses.length === 0" class="empty-state">
    <i class="fas fa-inbox"></i>
    <p>Aucune depense enregistree</p>
  </div>

  <div *ngIf="filteredExpenses.length > 0" class="expenses">
    <div *ngFor="let expense of expenses" class="expense-item">
      <div *ngIf="editingExpense?.id !== expense.id" class="expense-info">
        <div class="expense-header">
          <i [class]="getCategoryIcon(expense.category)"></i>
          <h3>{{ expense.description }}</h3>
          <span class="category-badge" [class]="expense.category">{{ expense.category }}</span>
        </div>
        <div class="expense-details">
          <span class="amount">
            <i class="fas fa-euro-sign"></i>
            {{ expense.amount | customCurrency }}
          </span>
          <span class="date">
            <i class="far fa-calendar"></i>
            {{ expense.date | date:'dd/MM/yyyy' }}
          </span>
        </div>
      </div>
      <div *ngIf="editingExpense?.id === expense.id && editingExpense" class="expense-edit">
        <input [(ngModel)]="editingExpense.description" placeholder="Description">
        <input type="number" [(ngModel)]="editingExpense.amount" placeholder="Montant">
        <input type="date" [(ngModel)]="editingExpense.date">
      </div>
      <div class="expense-actions">
        <button *ngIf="editingExpense?.id !== expense.id" class="edit-btn" (click)="editExpense(expense)">
          <i class="fas fa-edit"></i>
        </button>
        <button *ngIf="editingExpense?.id === expense.id" class="save-btn" (click)="saveEdit()">
          <i class="fas fa-check"></i>
        </button>
        <button *ngIf="editingExpense?.id === expense.id" class="cancel-btn" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
        </button>
        <button *ngIf="editingExpense?.id !== expense.id" class="delete-btn" (click)="deleteExpense(expense.id)">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="pagination" *ngIf="filteredExpenses.length > pageSize">
    <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">
      <i class="fas fa-chevron-left"></i>
    </button>
    <span>Page {{ currentPage }} / {{ totalPages }}</span>
    <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>

